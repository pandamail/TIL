# 📅 2025년 10월 15일 - 일일 학습 기록

## 🚀 오늘 한 일
- **`exam.spec.ts` 리팩토링 및 의존성 분리:**
  - 테스트가 특정 DB 데이터('컴퓨터학과')에 의존하는 문제를 해결하기 위해 `global-setup.ts`와 `beforeEach` 사용 방안을 논의했습니다.
  - `question.spec.ts`를 참고하여 `createExam`, `addStudentsToExam` 같은 헬퍼 함수를 도입, 코드 중복을 제거하고 가독성을 높였습니다.
  - '필수 항목 누락'과 같은 유효성(실패) 테스트 케이스를 추가하여 테스트 커버리지를 향상시켰습니다.

- **`login.spec.ts` 테스트 확장 및 고도화:**
  - 기존의 단순 로그인 성공 테스트에서 더 나아가, '잘못된 비밀번호 입력', '로그아웃', '사이드바 메뉴 접기' 등 인증 및 공통 UI 동작을 검증하는 테스트 스위트로 강화했습니다.

- **Jenkins 실패 디버깅 및 `global-setup` 최종 적용:**
  - Jenkins CI 환경에서 테스트가 실패하는 근본 원인(DB 스키마 및 데이터 부재)을 진단했습니다.
  - `setting.spec.ts`는 '검색 후 확인' 방식으로 테스트 자체의 안정성을 높여 해결했습니다.
  - `operation.spec.ts`처럼 데이터 의존성이 강한 테스트를 위해, `.sql` 스키마를 직접 분석하여 학과/학생/문제 데이터를 생성하는 최종 `global-setup.ts`를 작성하고 적용했습니다.

## 📚 새로 배운 것

### 테스트 리팩토링 원칙
- 리팩토링은 **'기존 동작을 변경하지 않고 코드의 구조만 개선하는 것'** 임을 다시 한번 상기했습니다. 새로운 기능을 추가하고 싶을 때는, **(1)기존 동작 확인 -> (2)구조 변경 -> (3)테스트 통과 확인 -> (4)새 기능 추가** 의 순서를 지키는 것이 중요합니다.

### 실패 테스트(Negative Test) 작성
- '의도된 실패'를 검증하는 테스트가 Playwright에서는 '실패'로 보고되는 상황을 디버깅했습니다. 오류 메시지의 미세한 띄어쓰기 차이(`"필수 항목입니다"` vs `"필수 항목 입니다."`)가 테스트 실패의 원인이 될 수 있음을 배웠습니다. 이는 로케이터나 검증 구문 작성 시 매우 세심한 주의가 필요하다는 것을 의미합니다.

### 테스트의 책임과 범위
- '메뉴 접기' 같은 공통 UI 테스트를 어느 테스트 파일(`login.spec.ts`? `common.spec.ts`?)에 포함할지 논의하며, **테스트 파일의 책임과 범위**를 고려하는 아키텍처적 접근의 중요성을 깨달았습니다. 항상 '가장 이상적인 구조'와 '현재 상황에서의 실용적인 선택' 사이에서 균형을 잡는 고민이 필요합니다.

### CI/CD 환경에서의 데이터 불일치
- 로컬에서는 성공하던 테스트가 CI 환경에서 실패하는 가장 흔한 원인인 **'환경 간 데이터 불일치'** 문제를 직접 경험했습니다. `global-setup.ts` 등을 통해 **어떤 환경에서든 동일한 상태에서 테스트를 시작하도록 보장(환경 초기화)**하는 것이 CI/CD 파이프라인의 안정성을 위해 얼마나 중요한지 확인했습니다.

## 🤔 고민한 부분
- 공통 UI 테스트(e.g., 사이드바 메뉴)를 별도의 파일로 분리하는 것이 장기적으로 더 나은 구조일지에 대해 고민했습니다. 하지만 현재 프로젝트 규모와 복잡도를 고려했을 때, 로그인 직후의 흐름을 검증하는 `login.spec.ts`에 포함하는 것이 더 실용적이라고 판단했습니다.

## 📌 내일 할 일
- [ ] `global-setup.ts` 적용 후 Jenkins 빌드 최종 성공 확인
- [ ] 다른 테스트 파일에도 리팩토링 원칙 적용 검토

---
**한 줄 회고**:
로컬의 성공이 CI의 성공을 보장하지 않는다는 것을 다시 한번 깨달았고, 테스트 환경을 일관되게 만드는 것의 중요성을 체감한 하루였습니다.

**태그**: #Playwright #E2E테스트 #리팩토링 #CI/CD #디버깅
