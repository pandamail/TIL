# [Project] 웹 UI 기반 Docker CBT 환경 자동 배포 시스템 구축 회고

## 🚀 프로젝트 목표
웹 UI에서 버튼 클릭 한 번으로, 학교별로 완벽하게 격리된 CBT(FE, BE, DB) Docker 환경을 동적으로 생성, 배포, 관리하는 자동화 시스템(PaaS)을 구축하는 것을 목표로 삼았다.

---

## 겪었던 문제와 해결 과정

### 1. 초기 아키텍처와 `Restarting`의 늪
처음에는 각 환경마다 FE/BE/DB 컨테이너를 모두 띄우는 방식을 시도했으나, 프론트엔드 컨테이너가 계속 `Restarting` 상태에 빠지는 문제에 직면했다. `docker exec`로 컨테이너 내부에 직접 접속하여 조사한 결과, 사용하려던 이미지에 웹 서버 실행 파일(`caddy`) 자체가 없다는 근본적인 원인을 밝혀냈다. 이 과정을 통해 컨테이너의 문제를 체계적으로 진단하는 실전 디버깅 능력을 길렀다.

### 2. 아키텍처의 전환: '마스터 Caddy'의 발견
선임분의 실제 운영 환경(`docker ps`)을 분석한 결과, 프론트엔드 컨테이너는 존재하지 않고 
**단 하나의 '마스터 Caddy'가 모든 요청을 처리**하는 '리버스 프록시' 구조임을 발견했다. 
이것이 모든 문제 해결의 열쇠였다.

### 3. 최종 아키텍처 구현
Flask(`main.py`)를 이용한 자동화 스크립트를 최종적으로 다음과 같이 완성했다.
- **BE/DB 스택 생성:** UI 요청 시, 각 학교의 백엔드와 DB 컨테이너 세트를 동적으로 생성한다.
- **동적 `env.js` 생성:** 각 프론트엔드가 자신에게 맞는 백엔드 주소를 찾아갈 수 있도록, `main.py`가 학교별 정보가 담긴 `env.js` 파일을 동적으로 생성하여 배포한다.
- **Caddy 리버스 프록시 설정:** 생성된 BE/DB 스택의 주소를 마스터 Caddy의 라우팅 규칙 파일(`.caddy`)에 자동으로 추가하고, `caddy reload`로 즉시 적용한다.



### 4. 실전 디버깅의 연속
로컬 개발 환경을 완성하는 과정에서 마주친 수많은 에러들을 해결했다.
- **`hosts` 파일:** 가상 도메인(`admin-kn.local`)을 가상머신 IP와 연결했다.
- **SSL 인증서:** Caddy의 자체 발급 인증서(`root.crt`)를 윈도우에 설치하여 `ERR_CERT_AUTHORITY_INVALID` 문제를 해결했다.
- **CORS 정책:** `Caddyfile`에 정확한 CORS 헤더 규칙을 추가하여 `CORS policy` 에러를 해결했다.
- **포트 충돌:** `lsof -i :[포트]` 명령어로 포트를 점유한 프로세스를 찾아 해결했다.

---

## 📖 프로젝트를 통해 배운 점
- **Docker와 시스템 아키텍처:** 단순히 컨테이너를 띄우는 것을 넘어, 리버스 프록시를 중심으로 여러 서비스를 유기적으로 연결하는 현대적인 웹 서비스 아키텍처를 직접 설계하고 구축하는 경험을 쌓았다.
- **자동화의 힘:** Python 스크립트로 파일 생성, Docker 명령어 실행 등 반복적인 작업을 자동화함으로써, 확장성 있고 효율적인 시스템을 만들 수 있음을 배웠다.
- **문제 해결 능력:** 원인 불명의 에러 앞에서 포기하지 않고, 가설을 세우고, 다양한 진단 도구로 검증하며, 근본 원인을 찾아 해결하는 개발자의 핵심 역량을 체득했다.