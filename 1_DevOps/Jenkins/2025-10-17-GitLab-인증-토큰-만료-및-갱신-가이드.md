# Jenkins-GitLab 연동 시 만료된 인증 토큰 갱신 가이드

이 문서는 Jenkins 파이프라인이 GitLab 저장소에 접근하지 못할 때, 만료되었거나 유효하지 않은 인증 토큰(Credential) 문제를 진단하고 해결하는 방법을 안내합니다.

## 1. 문제 상황

CI/CD 파이프라인 실행 시, Git 저장소에서 소스 코드를 가져오는(fetch/clone) 단계에서 빌드가 실패하며 아래와 유사한 인증 오류 로그가 발생합니다.

```bash
FATAL: Failed to fetch from https://gitlab.com/your-repo/project.git
hudson.plugins.git.GitException: Failed to fetch from https://gitlab.com/your-repo/project.git
...
Caused by: hudson.plugins.git.GitException: Command "git fetch --tags --force --progress -- https://gitlab.com/your-repo/project.git +refs/heads/*:refs/remotes/origin/*" returned status code 128:
stdout:
stderr: fatal: Authentication failed for 'https://gitlab.com/your-repo/project.git/'
```

이 오류는 Jenkins가 GitLab에 접근할 때 사용하는 인증 정보(주로 Personal Access Token)가 만료되었거나, 변경되었거나, 혹은 권한이 부족할 때 발생합니다.

## 2. 해결 과정

### Step 1: GitLab에서 Personal Access Token (PAT) 재발급

1.  **GitLab에 로그인**한 후, 우측 상단의 프로필 아이콘을 클릭하여 `Edit profile`로 이동합니다.
2.  왼쪽 메뉴에서 **`Access Tokens`**를 선택합니다.
3.  새로운 토큰을 생성합니다.
    *   **Token name:** `jenkins-access`와 같이 용도를 명확히 알 수 있는 이름을 지정합니다.
    *   **Expiration date:** 토큰 만료일을 설정합니다. (보안을 위해 주기적으로 갱신하는 것이 좋습니다.)
    *   **Scopes:** Jenkins가 저장소에 접근하는 데 필요한 최소한의 권한을 부여합니다. 일반적으로 `read_repository`와 `write_repository` 권한이면 충분합니다.
4.  **`Create personal access token`** 버튼을 클릭합니다.
5.  **생성된 토큰을 즉시 복사**하여 안전한 곳에 임시로 보관합니다. 이 페이지를 벗어나면 다시는 토큰을 확인할 수 없습니다.

### Step 2: Jenkins Credential 업데이트

1.  **Jenkins에 로그인**한 후, `Jenkins 관리` > `Security` 섹션의 **`Manage Credentials`**로 이동합니다.
2.  `Stores scoped to Jenkins` 아래의 `(global)` 도메인을 클릭합니다.
3.  업데이트가 필요한 기존 GitLab 인증 정보(Credential)의 `ID`를 찾아 클릭합니다.
4.  왼쪽 메뉴에서 **`Update`**를 선택합니다.
5.  **`Password`** 필드에 **Step 1에서 복사해 둔 새로운 GitLab Access Token을 붙여넣습니다.**
6.  **`Save`** 버튼을 클릭하여 변경 사항을 저장합니다.

## 3. 최종 검증

-   문제가 발생했던 Jenkins 파이프라인을 **재실행**합니다.
-   Git 저장소에서 코드를 정상적으로 가져오고 빌드가 다음 단계로 진행되는지 확인합니다.

---

**팁:** 토큰 만료로 인한 빌드 실패를 예방하려면, 토큰 생성 시 설정한 만료일을 개인 캘린더나 팀 공유 캘린더에 등록하여 미리 알림을 받는 것이 좋습니다.
